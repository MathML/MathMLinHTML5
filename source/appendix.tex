\appendix

\section{MathML}

{\em This section is non-normative.}

The {\tt mstyle} element duplicates the CSS inheritance mechanism in a
CSS-incompatible way and has many exceptions to workaround the fact that
attribute names may be used for different purposes. In practice, many of its
attributes are not useful and never used. It is a burden for implementers since
they essentially have to reimplement a specific ``attribute'' inheritance
mechanism to support the general case even if the most prominent attributes
have obvious mapping to CSS. It is also a performance issue to perform the
rendering and keep it up-to-date since the rendering on any node may depend on
its {\tt mstyle} ancestors. In this document, it instead suggested to keep only
attributes that are compatible with CSS and five new CSS properties are
introduced in section \ref{CSSProperties}.
These attributes actually correspond to what is used in practice.

The {\tt <mfenced>} element is just a
``convenient form in which to express common constructs involving fences''
but is strictly equivalent to an expanded form with {\tt <mrow>} and
{\tt <mo>} elements and has many exceptions to handle.
It is thus not actually necessary and just requires more
code for implementers and may lead to rendering inconsistencies with the
expanded form. It requires web rendering engines to create many
``anonymous'' rendering frames (or similar) and keep them up-to-date which may
lead to rendering, performance or security issues. Because the text of fences
and separators is included in attributes and not in MathML elements then by
default it may not be possible to search, select, copy it. It may also not be
exposed to assitive technologies without further effort. In this document
support for {\tt mfenced} is not required.
Authors are encouraged to use the expanded form and we recommend that the
element is dropped from future version of the MathML specification.

The ``radical'' notation of the {\tt <menclose>} element is equivalent to the
{\tt <msqrt>} element. Again, this adds duplicate logic for visual rendering and
exposure to assistive technologies. In practice, the {\tt <msqrt>} is always
used for square roots. We suggest to remove the ``radical'' notation in
future version of the MathML specification.

As explained in section \ref{LayoutSteps} it is important in a
HTML5 context to be able to determine the min-content width and the max-content
width for linebreaking purpose. However, the {\tt mpadded} element may be
problematic since the pseudo-units allow horizontal metrics to depend on
vertical metrics. A restriction is proposed in section \ref{mpadded} and should
not be problematic in practice.

The \TeX Book's Appendix G as well as the OpenType MATH table rely on the
``cramped'' concept to adjust spacing. This is absent from the MathML
specification. A simple way to determine when an element is cramped is
proposed in section \label{LaTeX}.

\section{CSS}

{\em This section is non-normative.}

Some {\tt mstyle} attributes follow the standard CSS inheritance and can be
easily implemented by mapping them to CSS properties. Five new CSS properties
would be needed for that purpose and are proposed in section
\ref{CSSProperties}:

\begin{enumerate}
\item {\tt mathml-math-style} (cf table \ref{tab:CSSMathStyle})
\item {\tt mathml-math-variant} (cf table \ref{tab:CSSMathVariant})
\item {\tt mathml-script-level} (cf table \ref{tab:CSSScriptLevel})
\item {\tt mathml-script-size-multiplier} (cf table \ref{tab:CSSScriptSizeMultiplier})
\item {\tt mathml-script-min-size} (cf table \ref{tab:CSSScriptSizeMinSize})
\end{enumerate}

In practice, only the first three properties are involved (either implicity
or explicitly) in documents with MathML content while the default values are
almost always used for the two last properties. Hence, these three first
properties seem the most important to consider.

\section{OpenType}

{\em This section is non-normative.}

It is not clear how the {\tt DisplayOperatorMinHeight\lxAddClass{MATH}} is
supposed to be used or whether it is really reliable. More specifically,
integral symbols (e.g. INTEGRAL U+222B) are typically taller than N-ary
operators (e.g. N-ARY SUMMATION U+2211) so a unique minimal height may not
always be enough to determine the display size. Suppose for example that the
sum has three size variants: the base size of height 1em, the display size
of height 2em and a bigger variant of height 3em.
Suppose that the integral has three sizes: a base size of
height 1em, a larger size variant of height 2em and a display size of height
3em. If {\tt DisplayOperatorMinHeight\lxAddClass{MATH}} is less than
3em then it does not force the display size of the integral to be selected.
If it is more than 3em then none of the available sizes satisfies the
condition. How to interpret that? Should we pick the largest as a fallback?
If it is 3em, the desired size will be selected for the integral in display
size but the one selected for the sum in display size will be too large.
A heuristic is proposed in section \ref{Operators} to workaround limitations
of {\tt DisplayOperatorMinHeight\lxAddClass{MATH}}.

The OpenType MATH specification does not seem to take into account
linebreaking. As explained in section \ref{LayoutSteps} it is important in a
HTML5 context to be able to determine the min-content width and the max-content
width. However when an operator is stretched vertically to cover a target size,
it is not possible to know the selected size variant or glyph assembly without
knowing the target size and so the min-content and max-content widths can only
be approximated. In practice, the width of the vertical operators is almost
independent on its stretch size. Should that be a requirement of the
OpenType MATH specification?

In section \ref{menclose} we describe the MathML {\tt menclose} element. This
one contains many notations that are not mentioned in the OpenType MATH
specification. Some rendering suggestions are given based on the value of
{\tt OverbarRuleThickness\lxAddClass{MATH}} but perhaps new values should be
introduced in the {\tt MathConstants\lxAddClass{MATH}} subtable to cover these
notations.

\section{Image Fallback}\label{ImageFallback}

{\em This section is non-normative.}

User agents that do not support MathML may decide to
render the fallback content provided by the {\tt altimg*} attributes in some
situations e.g. when they are specified or
under a preference option. In that case, an approximate implementation is to
render the {\tt math} element as a HTML {\tt img} element with the
value of {\tt altimg} as an {\tt src} attribute, the value of
{\tt alttext} as an {\tt alt} attribute, the value of {\tt altimg-width} as
the CSS {\tt width} property, the value of {\tt altimg-height} as
the CSS {\tt height} property and the value of {\tt altimg-valign} as
the CSS {\tt vertical-align} property \cite{HTML5} \cite{CSS2}. Here is a
partial implementation using the {\tt attr()} function of \cite{CSS3Values}:
%
\begin{lstlisting}
math {
  display: inline;
}
math[display="block"] {
  display: block;
  text-align: center;
}
math {
  background-image: attr(altimg url);
  width: attr(altimg-width length);
  height: attr(altimg-height length);
  vertical-align: attr(altimg-valign length);
}
math > * {
  display: none;
}
\end{lstlisting}
